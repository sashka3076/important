var hideTheScrollBars,cropData,$window=$(window);function exchangeElementStyle(a,b,c){Array.isArray(b)||(b=[b]),b.forEach(function(b){a.hasOwnProperty('style_'+b)||(a['style_'+b]=a.style.getPropertyValue(b)||null,a['style_'+b+'_priority']=a.style.getPropertyPriority(b)||null),a.style.setProperty(b,c,'important')})}function restoreElementStyle(a,b){Array.isArray(b)||(b=[b]),b.forEach(function(b){a.hasOwnProperty('style_'+b)&&(a.style.removeProperty(b),a.style.setProperty(b,a['style_'+b],a['style_'+b+'_priority']))})}var page={isWidthScroll:!1,isHeightScroll:!1,scrollLeft:0,scrollTop:0,windowWidth:0,windowHeight:0,documentWidth:0,documentHeight:0,currentX:0,cropData:null,currentY:0,scrollBarWidth:0,iframe:null,elm:null,fixedTopElements:[],fixedBottomElements:[],setVars:function(a){a.y2>document.height&&(a.y2=document.height),a.x2>document.width&&(a.x2=document.width),page.isWidthScroll=page.checkWidthScroll(),page.isHeightScroll=page.checkHeightScroll(),page.windowWidth=window.innerWidth,page.documentWidth=document.body.scrollWidth,page.documentHeight=document.body.scrollHeight,page.windowHeight=window.innerHeight,page.currentX=0,page.currentY=0,a&&a.y1>$window.scrollTop()&&a.x1>document.body.scrollLeft?(page.currentY=$window.scrollTop(),page.currentX=document.body.scrollLeft):(page.currentX=a.x1,page.currentY=a.y1)},scrollToCurrent:function(){$window.scrollTop(page.currentY),$window.scrollLeft(page.currentX)},saveScrollPos:function(){page.scrollLeft=$window.scrollLeft(),page.scrollTop=$window.scrollTop()},restoreScrollPos:function(){page.currentX=page.scrollLeft,page.currentY=page.scrollTop,page.scrollToCurrent()},computeNextScreen:function(){return cropData&&page.currentX+page.windowWidth>cropData.x2&&page.currentY+page.windowHeight>cropData.y2?!1:page.currentX+page.windowWidth<page.documentWidth?(page.currentX+=page.windowWidth,!0):(page.currentX=0,!(page.currentY+page.windowHeight>=page.documentHeight)&&(page.currentY+=page.windowHeight,!0))},checkWidthScroll:function(){return document.body.clientWidth<document.body.scrollWidth},checkHeightScroll:function(){return document.body.clientHeight<document.body.scrollHeight},enableScrollbar:function(a){a&&hideTheScrollBars?restoreElementStyle(document.body,['overflow-x','overflow-y']):(exchangeElementStyle(document.body,['overflow-x','overflow-y'],'hidden'),hideTheScrollBars=!0)},fixedElementCheck:function(){'fixed'===document.defaultView.getComputedStyle(document.body)['background-attachment']&&exchangeElementStyle(document.body,['background-attachment'],'initial');for(var a,b=document.createNodeIterator(document.documentElement,NodeFilter.SHOW_ELEMENT,null,!1),c=$window.height();a=b.nextNode();){var d=document.defaultView.getComputedStyle(a,'');if(!d)return;var e=d.getPropertyValue('position');'fixed'===e&&($(a).position().top<c/2?(0>page.fixedTopElements.indexOf(a)&&page.fixedTopElements.push(a),document.body.scrollHeight<2*c&&exchangeElementStyle(a,['position'],'absolute')):0>page.fixedBottomElements.indexOf(a)&&page.fixedBottomElements.push(a))}},hideFixedElement:function(a){const b='top'===a?page.fixedTopElements:page.fixedBottomElements;b.forEach(function(a){exchangeElementStyle(a,['display'],'none')})},showFixedElement:function(a){const b='top'===a?page.fixedTopElements:page.fixedBottomElements;b.forEach(function(a){restoreElementStyle(a,['display'])})},restore:function(){page.enableScrollbar(!0),page.restoreScrollPos(),setTimeout(()=>{page.fixedTopElements.forEach(function(a){restoreElementStyle(a,['display','position'])}),page.fixedBottomElements.forEach(function(a){restoreElementStyle(a,['display','position'])}),restoreElementStyle(document.body,['background-attachment']),page.fixedTopElements.length=0,page.fixedBottomElements.length=0},1e3)},onRequest:function(a,b,c){if('checkExist'===a.type)return void c();if(a.start){page.saveScrollPos();var d={x1:0,x2:32768,y1:0,y2:32765,scrollTop:$window.scrollTop(),scrollLeft:document.body.scrollLeft};a.scroll||(d.x1=window.scrollX,d.y1=window.scrollY,d.x2=window.innerWidth+d.x1,d.y2=window.innerHeight+d.y1),cropData=$.extend(d,a.cropData);const b=32668;cropData.y2-cropData.y1>b&&(cropData.y2=cropData.y1+b),cropData.x2-cropData.x1>b&&(cropData.x2=cropData.x1+b)}if('takeCapture'===a.type){var e={};a.start&&(detect_zoom(),page.setVars(cropData),a.scroll&&!a.showScrollBar&&page.enableScrollbar(!1),a.scroll&&a.processFixedElements&&page.fixedElementCheck()),page.scrollToCurrent(),a.scroll&&a.processFixedElements&&setTimeout(function(){page.fixedElementCheck(),page.hideFixedElement(a.start?'bottom':'top'),e.finish&&(page.showFixedElement('bottom'),$window.scrollTop()<$window.height()&&page.showFixedElement('top'))},50),e.top=parseInt($window.scrollTop()-cropData.y1,10),e.left=parseInt(document.body.scrollLeft-cropData.x1,10),e.finish=!a.scroll||!page.computeNextScreen(),e.finish&&(e.width=parseInt(cropData.x2-cropData.x1,10),e.height=parseInt(cropData.y2-cropData.y1,10),e.url=document.location.toString(),e.title=document.title),e._devicePixelRatio=devicePixelRatio,c(e)}'finish'===a.type&&page.restore(),'captureRegion'===a.data?load_cropper_without_selection():'editContent'===a.data&&(alert('Now you can edit this page'),document.designMode='on')}};chrome.runtime.onMessage.addListener(page.onRequest);